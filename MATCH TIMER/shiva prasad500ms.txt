

 

 

                                                                #include "usrdef.h"
                                                         #include <lpc17xx.h>
 

                                                         #define PRESCALE (18000-1) //18000 PCLK clock cycles to increment TC by 1
 

                                                         void initTimer0(void);
                                                        
                                                         int main(void)
                                                         {
                                                                SystemInit(); //called by Startup Code before main(), hence no need to call again.
                                                                initTimer0(); //Initialize Timer0
                                                                //LPC_GPIO0->FIODIR = (1<<22); //Configure P0.22 as output
                                                                PinDir(2,11,OUTPUT);
                                                                while(1)
                                                                {
                                                                }
                                                         }
 

                                                         void initTimer0(void)
                                                         {
                                                                LPC_SC->PCONP |= (1<<1); //Power up TIM0.
                                                                LPC_SC->PCLKSEL0 &= ~(0x3<<2); //Set PCLK for timer = CCLK/4 = 72/4 = 18Mhz (default)
 

                                                                LPC_TIM0->CTCR = 0x0;// using timer mode
                                                                LPC_TIM0->PR = PRESCALE; //Increment LPC_TIM0->TC at every 17999+1 clock cycles
                                                                //18000 clock cycles @18Mhz = 1 mS
    PinSelFunc(1,28,3);//selected MAT0
                                                                LPC_TIM0->TCR = 0x02; //Reset Timer to 0
                                                                LPC_TIM0->MCR =0x1<<1 | 0x1<<0;//generate interrupt on match MR0 with TC and RESET TC
                                                                LPC_TIM0->MR0 = 500;//500ms delay
                                                                NVIC_EnableIRQ(1);//enable timer 0 interrupt
                                                                LPC_TIM0->TCR = 0x01 << 1; //Reset Timer to 0
                                                                LPC_TIM0->TCR = 0x01; //Enable timer
                                                         }
 

 

 

                                                         void TIMER0_IRQHandler(void)
                                                         {
                                                                LPC_TIM0->IR |= 0x1 << 0;//reset the interrupt
                                                                LPC_TIM0->EMR |=0x3 << 4 ;// Toggle MAT0 pin when TC matchs with MR0
                                                         //   LPC_TIM0->TCR = 0x02; //Reset Timer to 0
                                                         }